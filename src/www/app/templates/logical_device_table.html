{% extends "base.html" %}
{% block content%}

	<div class="command-bar">
		<div class="form-buttons">
			<ul>
				<li></li>
			</ul>
		</div>
	</div>
	
	<section id="device-table">
		<div class="container">
			<h2 class="form-heading"><span class='logical-device-orange-icon'></span> Logical Devices</h2>
			<table class="table table-striped data-table">
				<thead>
					<tr>
						<th>UID</th>
						<th>NAME</th>
						<th>LOCATION</th>
						<th>LAST SEEN</th>
					</tr>
				</thead>
				<tbody>
					{% for logicalDevice in logicalDevices %}
					<tr>
						<td>{{ logicalDevice.uid }}</td>
						<td><a href="{{ url_for('logical_device_form', uid=logicalDevice.uid) }}">{{ logicalDevice.name }}</a></td>
						<td>{{ logicalDevice.location }}</td>
						<td>{{ logicalDevice.last_seen }}</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
			<div>
				<h2 class="form-heading">Graph</h2>
				<label for="luid">Logical ID</label>
				<select id="luid" name="luid">
					{% for logicalDevice in logicalDevices %}
					<option value="{{ logicalDevice.uid }}">{{ logicalDevice.uid }}</option>
					{% endfor %}
				</select>
				<!-- Checkbox to toggle date inputs -->
				<div>
					<input type="checkbox" id="dateToggle" name="dateToggle">
					<label for="dateToggle">Specify Date Range</label>
				</div>
				
				<!-- Date inputs (hidden by default) -->
				<div id="dateInputs" style="display: none;">
					<label for="startDate">Start Date:</label>
					<input type="date" id="startDate" name="startDate">
				
					<label for="endDate">End Date:</label>
					<input type="date" id="endDate" name="endDate">
				</div>
				<script>
					$(document).ready(function () {
						// Toggle date inputs based on checkbox state
						$('#dateToggle').on('change', function () {
							if ($(this).prop('checked')) {
								$('#dateInputs').show();
							} else {
								$('#dateInputs').hide();
							}
						});

						// Existing code for fetching data based on l_uid
						$('#luid').on('change', function () {
							const selectedLuid = $(this).val();
							const startDate = $('#startDate').val();
							const endDate = $('#endDate').val();

							let apiUrl = `http://localhost:9898/l_uid/${selectedLuid}`;
							if ($('#dateToggle').prop('checked')) {
								apiUrl += `?fromdate=${startDate}&todate=${endDate}`;
							}

							fetch(apiUrl)
								.then(response => response.json())
								.then(data => {
									let htmlContent = '<ul>';
									for (let record of data) {
										htmlContent += `<li>${JSON.stringify(record)}</li>`;
									}
									htmlContent += '</ul>';
									$('#luid-data').html(htmlContent);
								})
								.catch(error => {
									console.error('Error fetching l_uid data:', error);
								});
						});
					});
				</script>
				<div id="luid-data"></div>
				</div>
			<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
			<script>
				$(document).ready(function () {
					$('#luid').on('change', function () {
						const selectedLuid = $(this).val();
						// Make the request to the FastAPI application
						fetch(`http://localhost:9898/l_uid/${selectedLuid}`)
							.then(response => response.json())
							.then(data => {
								// Display the data in the #luid-data div
								let htmlContent = '<ul>';
								for (let record of data) {
									htmlContent += `<li>${JSON.stringify(record)}</li>`;
								}
								htmlContent += '</ul>';
								$('#luid-data').html(htmlContent);
							})
							.catch(error => {
								console.error('Error fetching l_uid data:', error);
							});
					});
				});
			</script>
		</div>
	</section>

	{% endblock %}